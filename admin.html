<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hallenmeister ‚Äì Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    :root {
        --bg: #f3f4f6;
        --card: #ffffff;
        --border: #e5e7eb;
        --text: #111827;
        --text-soft: #6b7280;

        --red: #c8102e;
        --blue: #0047ab;
        --blue-soft: #e0edff;
        --gold: #f7b500;

        --danger: #b91c1c;
        --danger-soft: #fef2f2;

        --radius: 14px;
    }

    body {
        font-family: "Inter", sans-serif;
        background: radial-gradient(circle at top, #ffffff, #f3f4f6 55%);
        margin: 0;
        padding: 24px;
        color: var(--text);
    }

    .app { max-width: 1150px; margin: 0 auto; }

    /* --- LOCKSCREEN --- */
    #lockScreen {
        position: fixed;
        inset: 0;
        background: rgba(15,23,42,0.82);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }

    #lockCard {
        background: #111827;
        color: #e5e7eb;
        padding: 24px 26px;
        border-radius: 16px;
        width: 100%;
        max-width: 320px;
        text-align: center;
    }

    #lockInput {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 10px;
        border: 1px solid #4b5563;
        background: #020617;
        color: #e5e7eb;
    }

    #lockBtn {
        width: 100%;
        padding: 10px;
        border-radius: 999px;
        border: none;
        background: linear-gradient(135deg,#22c55e,#16a34a);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
    }

    /* --- HERO HEADER --- */
    .hero {
        display: flex;
        justify-content: space-between;
        padding: 18px 22px;
        border-radius: 20px;
        background: linear-gradient(135deg, var(--red), var(--blue));
        color: white;
        box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        margin-bottom: 26px;
    }

    .logo-wrap {
        width: 78px;
        height: 78px;
        border-radius: 18px;
        padding: 6px;
        background: #ffffff;
        box-shadow: 0 12px 25px rgba(0,0,0,0.28);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .logo-wrap img {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }

    /* --- CARDS --- */
    .card {
        background: white;
        border-radius: 14px;
        border: 1px solid #e5e7eb;
        padding: 18px 20px;
        margin-bottom: 16px;
        box-shadow: 0 10px 26px rgba(15,23,42,0.08);
    }

    .field-row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    input, select {
        width: 100%;
        padding: 9px 11px;
        border-radius: 9px;
        border: 1px solid #ddd;
        background: #f9fafb;
        font-size: 0.9rem;
    }

    button {
        padding: 9px 16px;
        border-radius: 999px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        margin-top: 6px;
        margin-right: 6px;
    }

    .btn-main {
        background: linear-gradient(135deg, var(--blue), var(--red));
        color: white;
    }

    .btn-danger {
        background: var(--danger-soft);
        color: var(--danger);
        border: 1px solid #fecaca;
    }

    /* --- TABLE --- */
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        overflow: hidden;
        border-radius: 12px;
    }

    th, td {
        padding: 10px 8px;
        text-align: center;
        border-bottom: 1px solid #eee;
    }

    th {
        background: #eef2ff;
        font-weight: 600;
    }

    tr.gold   { background: #fff7b0; }
    tr.silver { background: #e5e7eb; }
    tr.bronze { background: #ffd7c2; }
</style>
</head>

<body>

<!-- LOCKSCREEN -->
<div id="lockScreen">
    <div id="lockCard">
        <h2>Admin Login</h2>
        <p>Passwort eingeben:</p>
        <input id="lockInput" type="password">
        <button id="lockBtn">Entsperren</button>
        <div id="lockError"></div>
    </div>
</div>

<div id="app" class="app" style="display:none">

<header class="hero">
    <div style="display:flex; gap:18px; align-items:center;">
        <div class="logo-wrap">
            <img src="logo.png">
        </div>
        <div>
            <h1>Hallenmeister Admin</h1>
            <small>Sieg 3 ¬∑ Unentschieden 1 ¬∑ Tor 1</small>
        </div>
    </div>
    <div style="font-size:0.85rem; opacity:0.8">ADMIN</div>
</header>

<!-- PLAYER ADD -->
<div class="card">
    <h3>Spieler hinzuf√ºgen</h3>
    <div class="field-row">
        <input id="playerName" placeholder="Spielername">
        <select id="playerTeamSelect"><option value="">(kein Team)</option></select>
    </div>
    <button class="btn-main" onclick="addPlayer()">Hinzuf√ºgen</button>
</div>

<!-- PLAYER MANAGE -->
<div class="card">
    <h3>Spieler verwalten</h3>
    <select id="managePlayer"></select>

    <div class="field-row">
        <select id="managePlayerTeam"><option value="">(kein Team)</option></select>
    </div>

    <button class="btn-main" onclick="updatePlayerTeam()">Team setzen</button>
    <button class="btn-main" onclick="renamePlayer()">Umbenennen</button>
    <button class="btn-danger" onclick="deletePlayer()">L√∂schen</button>
</div>

<!-- TEAMS -->
<div class="card">
    <h3>Teams verwalten</h3>
    <div class="field-row">
        <input id="teamName" placeholder="Teamname">
        <button class="btn-main" onclick="addTeam()">Team hinzuf√ºgen</button>
    </div>

    <select id="manageTeam"></select>
    <button class="btn-main" onclick="renameTeam()">Umbenennen</button>
    <button class="btn-danger" onclick="deleteTeam()">Team l√∂schen</button>
</div>

<!-- TEAM RESULT -->
<div class="card">
    <h3>Team-Ergebnis eintragen</h3>

    <select id="teamResultSelect"><option value="">Team w√§hlen</option></select>

    <button class="btn-main" onclick="applyTeamResult('g')">Sieg (+3)</button>
    <button class="btn-main" onclick="applyTeamResult('u')">Unentschieden (+1)</button>
    <button class="btn-danger" onclick="applyTeamResult('v')">Niederlage</button>
</div>

<!-- STATS -->
<div class="card">
    <h3>Tore eintragen</h3>

    <select id="statPlayer"></select>
    <input id="goals" type="number" placeholder="Tore">

    <button class="btn-main" onclick="addStats()">Eintragen</button>
    <button class="btn-danger" onclick="undoLast()">R√ºckg√§ngig</button>
</div>
    <!-- TABLE -->
<div class="card">
    <h3>Tabelle</h3>
    <table id="table">
        <thead>
            <tr>
                <th>#</th>
                <th>Spieler</th>
                <th>Punkte</th>
                <th>S</th>
                <th>U</th>
                <th>N</th>
                <th>Spiele</th>
                <th>Tore</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- LOGS -->
<div class="card">
    <h3>Logs</h3>
    <pre id="logBox"></pre>
</div>

</div><!-- app -->

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const ADMIN_PASSWORD = "1234";

let unlocked = false;
let players = {};
let teams = {};
let logs = [];
let historyStack = [];

const firebaseConfig = {
  apiKey: "AIzaSyD6e3gVyYhC3XGr0fXnbONltHaQXITsPW8",
  authDomain: "hallenmeister-jfg.firebaseapp.com",
  databaseURL: "https://hallenmeister-jfg-default-rtdb.firebaseio.com",
  projectId: "hallenmeister-jfg",
  storageBucket: "hallenmeister-jfg.firebasestorage.app",
  messagingSenderId: "116609969538",
  appId: "1:116609969538:web:e00d5b82ac49609aae339b",
  measurementId: "G-ZTY1D51LGK"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

const playersRef = ref(db, "players");
const teamsRef   = ref(db, "teams");
const logsRef    = ref(db, "logs");

onValue(playersRef, snap => {
    players = snap.val() || {};
    updateDropdowns();
    updateTable();
});

onValue(teamsRef, snap => {
    teams = snap.val() || {};
    updateTeamUI();
});

onValue(logsRef, snap => {
    logs = snap.val() || [];
    updateLogs();
});

function saveAll() {
    if (!unlocked) return;
    set(playersRef, players);
    set(teamsRef, teams);
    set(logsRef, logs);
}

/* LOGIN */
lockBtn.onclick = () => {
    if (lockInput.value === ADMIN_PASSWORD) {
        unlocked = true;
        lockScreen.style.display = "none";
        app.style.display = "block";
    } else {
        lockError.textContent = "Falsches Passwort.";
    }
};

/* ==== PLAYER ==== */
window.addPlayer = function() {
    if (!unlocked) return;

    const name  = playerName.value.trim();
    const team  = playerTeamSelect.value;

    if (!name || players[name]) return;

    players[name] = {
        points: 0,
        wins: 0,
        draws: 0,
        losses: 0,
        goals: 0,
        team: team || ""
    };

    logs.push(`‚ûï Spieler hinzugef√ºgt: ${name}`);
    saveAll();
    playerName.value = "";
};

window.renamePlayer = function() {
    if (!unlocked) return;

    const oldName = managePlayer.value;
    const neu = prompt("Neuer Name:", oldName);
    if (!neu || players[neu]) return;

    players[neu] = players[oldName];
    delete players[oldName];

    logs.push(`‚úè Umbenannt: ${oldName} ‚Üí ${neu}`);
    saveAll();
};

window.deletePlayer = function() {
    if (!unlocked) return;
    const name = managePlayer.value;
    if (!name || !confirm("Spieler l√∂schen?")) return;

    delete players[name];
    logs.push(`üóë Spieler gel√∂scht: ${name}`);
    saveAll();
};

window.updatePlayerTeam = function() {
    if (!unlocked) return;

    const name = managePlayer.value;
    const team = managePlayerTeam.value;

    players[name].team = team;
    logs.push(`üëï Team gesetzt: ${name} ‚Üí ${team}`);
    saveAll();
};

/* ==== TEAMS ==== */
window.addTeam = function() {
    const name = teamName.value.trim();
    if (!name || teams[name]) return;
    teams[name] = true;
    logs.push(`üèüÔ∏è Team hinzugef√ºgt: ${name}`);
    saveAll();
    teamName.value = "";
};

window.renameTeam = function() {
    const old = manageTeam.value;
    const neu = prompt("Neuer Name:", old);
    if (!neu || teams[neu]) return;

    delete teams[old];
    teams[neu] = true;

    Object.keys(players).forEach(p => {
        if (players[p].team === old) players[p].team = neu;
    });

    logs.push(`üèüÔ∏è Team umbenannt: ${old} ‚Üí ${neu}`);
    saveAll();
};

window.deleteTeam = function() {
    const name = manageTeam.value;
    if (!confirm("Team l√∂schen? Spieler behalten ihr Team nicht.")) return;

    delete teams[name];
    Object.keys(players).forEach(p => {
        if (players[p].team === name) players[p].team = "";
    });

    logs.push(`üóë Team gel√∂scht: ${name}`);
    saveAll();
};

/* ==== TEAM RESULT ==== */
window.applyTeamResult = function(result) {
    const team = teamResultSelect.value;
    if (!team) return;

    Object.keys(players).forEach(p => {
        if (players[p].team === team) {
            if (result === "g") {
                players[p].wins++;
                players[p].points += 3;
            } else if (result === "u") {
                players[p].draws++;
                players[p].points += 1;
            } else {
                players[p].losses++;
            }
        }
    });

    logs.push(`‚öΩ Team-Ergebnis: ${team} ‚Üí ${result}`);
    saveAll();
};

/* ==== GOALS ONLY ==== */
window.addStats = function() {
    const name = statPlayer.value;
    const g = parseInt(goals.value) || 0;
    if (!name || g === 0) return;

    players[name].goals += g;
    players[name].points += g;

    logs.push(`‚öΩ Tore: ${name} ‚Üí +${g}`);
    saveAll();

    goals.value = "";
};

/* ==== TABLE ==== */
function updateTable() {
    const tbody = document.querySelector("#table tbody");
    tbody.innerHTML = "";

    const sorted = Object.entries(players)
        .sort((a,b) => b[1].points - a[1].points);

    sorted.forEach(([name,p], idx) => {
        const spiele = p.wins + p.draws + p.losses;

        tbody.innerHTML += `
            <tr>
                <td>${idx+1}</td>
                <td>${name}${p.team ? " ("+p.team+")" : ""}</td>
                <td>${p.points}</td>
                <td>${p.wins}</td>
                <td>${p.draws}</td>
                <td>${p.losses}</td>
                <td>${spiele}</td>
                <td>${p.goals}</td>
            </tr>
        `;
    });
}

/* ==== UI ==== */
function updateDropdowns() {
    managePlayer.innerHTML = "";
    statPlayer.innerHTML = "";

    Object.keys(players).forEach(p => {
        managePlayer.innerHTML += `<option>${p}</option>`;
        statPlayer.innerHTML   += `<option>${p}</option>`;
    });
}

function updateTeamUI() {
    const arr = Object.keys(teams);

    playerTeamSelect.innerHTML = '<option value="">(kein Team)</option>';
    managePlayerTeam.innerHTML = '<option value="">(kein Team)</option>';
    teamResultSelect.innerHTML = '<option value="">Team w√§hlen</option>';
    manageTeam.innerHTML = "";

    arr.forEach(t => {
        playerTeamSelect.innerHTML += `<option>${t}</option>`;
        managePlayerTeam.innerHTML += `<option>${t}</option>`;
        manageTeam.innerHTML += `<option>${t}</option>`;
        teamResultSelect.innerHTML += `<option>${t}</option>`;
    });
}

function updateLogs() {
    logBox.textContent = logs.join("\n");
}

</script>
</body>
</html>

